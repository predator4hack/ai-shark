# Founder Simulation Agent

**Objective**: Build an fonder simulation agent that answers the questionnaire document based on the reference documents uploaded

## Implementation Details

Prerequeisite: The founders-checklis.md document is ready from the previous pipeline.

1. UI: Two uplaod sections pop ups:
   a. The first upload section allows the user to upload real Q&A document where each of the questions are answered by the founder.
   b. The second upload section is to allow user to upload reference documents(founders-checklist, draft investment memo etc.) mentioning that this will simulate the Question answering using an agent

2. If the user selects the second option, and uplaods the document(pdf or docx), the content should be extracted and stored in /outputs/<company-name>/ref-data/ in markdown format. Company name you can extract from the previous workflows. If only it's feasible, try to reuse the exising extractin pipelines.

3. Once the files are extracted, create an agent that would ingest all the documents in the ref-data and pass it to LLM, along with /outputs/<company-name>/founders-checklist.md. The LLM should answer all the questions in the founders-checklist based on all the documents in the ref-data and output a file /outputs/<company-name>/ans-founders-checklist.md

4. If the user selects the option to upload the Q&A document, the pipeline should extract the information and directly create /outputs/<company-name>/ans-founders-checklist.md and store.

Try to use existing data extraction pipelines to extract information. Assume that the documents uploaded by the user are pdf or docx.

Clarifications Needed

1. Founders Checklist Source: Where does the base founders-checklist.md
   template come from? Is it generated by the existing questionnaire
   agent or do we need a static template?
   If you check the streamlit_app.py and you'll an analysis_pipeline() method called in the main() method. I want to show these upload buttons only after the analysis pipeline is completed. If there is no founders-checklist.md found after that pipeline, you can terminate and log error

2. Company Name Resolution: If user starts with reference documents
   upload (option 2) without processing a pitch deck first, how should we
   determine the company name for the directory structure?
   Nope, upload button for both the options should not be shown untill analysis_pipeline() is executed without any errors

3. UI Integration: Should this be:

    - A new section in the existing streamlit app, or
    - A separate page/tab, or
    - Replace/modify the existing additional docs section?

    These button should show up just below the analysis pipeline results once they are completed

4. Q&A Document Format: For option 1 (direct Q&A upload), what format
   should we expect? Is it:

    - Structured Q&A pairs in text/markdown?
    - A filled questionnaire form?
    - Free-form responses that need parsing?
      You can expect a docx or pdf with questions and answers pairs

5. Reference Document Scope: Should the agent simulation consider:

    - Only documents in ref-data directory, or
    - Also include existing pitch_deck.md and public_data.md?
      only documets in ref-data directory

6. Agent Implementation: Should this reuse the existing
   QuestionnaireAgent or create a new specialized agent for founder
   simulation?

    Create a new specialized agent for founder simulation

## Detailed Implementation Plan

### Overview
The Founder Simulation Agent will be integrated into the existing Streamlit application, appearing after the analysis pipeline completes successfully. It will provide two upload options for processing founder questionnaire responses.

### Prerequisites
- Analysis pipeline must complete successfully
- `founders-checklist.md` must exist in `/outputs/<company-name>/`
- Company name and directory structure established from previous pipeline

### Components to Implement

#### 1. Frontend UI Components (Streamlit)
**File**: `src/ui/streamlit_app.py`

**Location**: Add new section after `display_analysis_results()` function

**Components needed**:
- `founder_simulation_section()` - Main section container
- Two radio button options:
  - "Upload Real Q&A Document" 
  - "Upload Reference Documents for AI Simulation"
- File uploader widgets for each option
- Processing status indicators
- Results display area

**Integration Points**:
- Show section only after analysis pipeline success
- Check for `founders-checklist.md` existence
- Use existing `get_company_name_from_session()` for company identification
- Follow existing UI patterns for file upload and processing

#### 2. Reference Document Processor
**File**: `src/processors/ref_doc_processor.py` (new)

**Purpose**: Handle reference document uploads and storage

**Key Methods**:
- `process_reference_documents(uploaded_files, company_dir)` - Main processing method
- `extract_and_save_to_ref_data(file_path, company_dir)` - Extract content and save to ref-data/
- `validate_company_directory(company_dir)` - Ensure founders-checklist.md exists

**Features**:
- Reuse existing `AdditionalDocProcessor` for text extraction
- Save documents to `/outputs/<company-name>/ref-data/` in markdown format
- Generate consistent naming convention for saved files
- Return processing results with file paths and status

#### 3. Founder Simulation Agent
**File**: `src/agents/founder_simulation_agent.py` (new)

**Purpose**: AI agent that simulates founder responses based on reference documents

**Key Components**:
- `FounderSimulationAgent` class extending base agent pattern
- `process_simulation(company_dir)` - Main simulation method
- `load_reference_documents(ref_data_dir)` - Load all ref-data markdown files
- `load_founders_checklist(checklist_path)` - Load questionnaire template
- `generate_simulated_responses(questions, ref_content)` - LLM interaction
- `save_simulation_results(responses, output_path)` - Save to ans-founders-checklist.md

**LLM Integration**:
- Use existing `LLMManager` for consistency
- Implement prompt engineering for founder response simulation
- Handle context window limitations for large reference document sets
- Provide fallback handling for incomplete responses

#### 4. Q&A Document Processor
**File**: `src/processors/qa_doc_processor.py` (new)

**Purpose**: Process direct Q&A document uploads

**Key Methods**:
- `process_qa_document(file_path, company_dir)` - Main processing method
- `extract_qa_pairs(text_content)` - Parse Q&A format from extracted text
- `map_to_founders_checklist(qa_pairs, checklist_questions)` - Match Q&A to checklist format
- `save_qa_responses(mapped_responses, output_path)` - Save to ans-founders-checklist.md

**Features**:
- Reuse existing text extraction from `AdditionalDocProcessor`
- Implement Q&A parsing logic for various formats
- Map extracted answers to founder checklist question structure
- Handle mismatched or missing questions gracefully

#### 5. Models and Data Structures
**File**: `src/models/founder_simulation_models.py` (new)

**Purpose**: Define data structures for founder simulation

**Classes**:
```python
@dataclass
class FounderSimulationConfig:
    company_dir: str
    simulation_type: str  # "reference_docs" or "direct_qa"
    use_real_llm: bool = True
    max_retries: int = 3

@dataclass
class SimulationResult:
    success: bool
    output_file: Optional[str]
    processing_time: float
    error_message: Optional[str]
    metadata: Dict[str, Any]

@dataclass
class QAEntry:
    question: str
    answer: str
    confidence: float
    source_documents: List[str]
```

#### 6. Utility Functions
**File**: `src/utils/founder_simulation_utils.py` (new)

**Purpose**: Helper functions for founder simulation

**Functions**:
- `validate_founders_checklist_exists(company_dir)` - Check prerequisite
- `create_ref_data_directory(company_dir)` - Ensure ref-data/ exists
- `load_all_markdown_files(directory)` - Batch load reference documents
- `format_simulation_output(qa_entries, metadata)` - Format final output
- `calculate_simulation_confidence(responses)` - Quality scoring

### Implementation Steps

#### Phase 1: Core Infrastructure
1. Create model classes in `founder_simulation_models.py`
2. Implement utility functions in `founder_simulation_utils.py`
3. Create base processor structure for reference documents
4. Set up directory structure and file handling

#### Phase 2: Document Processing
1. Implement `RefDocProcessor` for reference document handling
2. Implement `QADocProcessor` for direct Q&A processing
3. Integrate with existing `AdditionalDocProcessor` for text extraction
4. Add comprehensive error handling and validation

#### Phase 3: AI Agent Implementation
1. Create `FounderSimulationAgent` class
2. Implement LLM prompt engineering for founder response simulation
3. Add context management for large document sets
4. Implement response quality validation

#### Phase 4: UI Integration
1. Add founder simulation section to Streamlit app
2. Implement file upload widgets and processing triggers
3. Add progress indicators and status displays
4. Integrate results display with existing patterns

#### Phase 5: Testing and Validation
1. Test with various document formats and sizes
2. Validate Q&A parsing accuracy
3. Test LLM response quality and consistency
4. End-to-end testing of complete workflow

### File Structure Changes

```
src/
├── agents/
│   └── founder_simulation_agent.py (new)
├── models/
│   └── founder_simulation_models.py (new)
├── processors/
│   ├── ref_doc_processor.py (new)
│   └── qa_doc_processor.py (new)
├── utils/
│   └── founder_simulation_utils.py (new)
└── ui/
    └── streamlit_app.py (modified)

outputs/<company-name>/
├── founders-checklist.md (prerequisite)
├── ref-data/ (new directory)
│   ├── document1.md
│   └── document2.md
└── ans-founders-checklist.md (output)
```

### Integration Points

1. **Session State**: Use existing session state management for company tracking
2. **File Upload**: Follow existing patterns from pitch deck and additional docs sections
3. **Error Handling**: Consistent with existing error display patterns
4. **LLM Integration**: Use existing `LLMManager` for API calls
5. **Output Management**: Use existing `OutputManager` for file operations

### Error Handling Strategy

1. **Prerequisite Validation**: Check for analysis completion and founders-checklist.md
2. **File Processing**: Handle corrupt/unreadable documents gracefully
3. **LLM Failures**: Implement retry logic and fallback responses
4. **Directory Management**: Ensure proper permissions and directory creation
5. **User Feedback**: Clear error messages and recovery instructions

### Performance Considerations

1. **Large Documents**: Implement chunking for large reference document sets
2. **LLM Context**: Manage token limits with document summarization if needed
3. **File I/O**: Async processing for multiple file uploads
4. **Memory Usage**: Stream processing for large files
5. **Response Time**: Progress indicators for long-running operations

This implementation plan provides a comprehensive roadmap that maintains consistency with the existing codebase while adding the new founder simulation functionality. The modular approach allows for incremental development and testing.
